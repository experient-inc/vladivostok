var url_serializer_1 = require('../src/url_serializer');
var url_tree_1 = require('../src/url_tree');
var shared_1 = require('../src/shared');
var router_state_1 = require('../src/router_state');
var create_router_state_1 = require('../src/create_router_state');
var recognize_1 = require('../src/recognize');
describe('create router state', function () {
    var emptyState = function () { return router_state_1.createEmptyState(new url_tree_1.UrlTree(new url_tree_1.UrlSegment([], {}), {}, null), RootComponent); };
    it('should work create new state', function () {
        var state = create_router_state_1.createRouterState(createState([
            { path: 'a', component: ComponentA },
            { path: 'b', component: ComponentB, outlet: 'left' },
            { path: 'c', component: ComponentC, outlet: 'right' }
        ], "a(left:b//right:c)"), emptyState());
        checkActivatedRoute(state.root, RootComponent);
        var c = state.children(state.root);
        checkActivatedRoute(c[0], ComponentA);
        checkActivatedRoute(c[1], ComponentB, 'left');
        checkActivatedRoute(c[2], ComponentC, 'right');
    });
    it('should reuse existing nodes when it can', function () {
        var config = [
            { path: 'a', component: ComponentA },
            { path: 'b', component: ComponentB, outlet: 'left' },
            { path: 'c', component: ComponentC, outlet: 'left' }
        ];
        var prevState = create_router_state_1.createRouterState(createState(config, "a(left:b)"), emptyState());
        advanceState(prevState);
        var state = create_router_state_1.createRouterState(createState(config, "a(left:c)"), prevState);
        expect(prevState.root).toBe(state.root);
        var prevC = prevState.children(prevState.root);
        var currC = state.children(state.root);
        expect(prevC[0]).toBe(currC[0]);
        expect(prevC[1]).not.toBe(currC[1]);
        checkActivatedRoute(currC[1], ComponentC, 'left');
    });
    it('should handle componentless routes', function () {
        var config = [
            { path: 'a/:id', children: [
                    { path: 'b', component: ComponentA },
                    { path: 'c', component: ComponentB, outlet: 'right' }
                ] }
        ];
        var prevState = create_router_state_1.createRouterState(createState(config, "a/1;p=11/(b//right:c)"), emptyState());
        advanceState(prevState);
        var state = create_router_state_1.createRouterState(createState(config, "a/2;p=22/(b//right:c)"), prevState);
        expect(prevState.root).toBe(state.root);
        var prevP = prevState.firstChild(prevState.root);
        var currP = state.firstChild(state.root);
        expect(prevP).toBe(currP);
        var prevC = prevState.children(prevP);
        var currC = state.children(currP);
        expect(currP._futureSnapshot.params).toEqual({ id: '2', p: '22' });
        checkActivatedRoute(currC[0], ComponentA);
        checkActivatedRoute(currC[1], ComponentB, 'right');
    });
});
function advanceState(state) {
    advanceNode(state._root);
}
function advanceNode(node) {
    router_state_1.advanceActivatedRoute(node.value);
    node.children.forEach(advanceNode);
}
function createState(config, url) {
    var res;
    recognize_1.recognize(RootComponent, config, tree(url), url).forEach(function (s) { return res = s; });
    return res;
}
function checkActivatedRoute(actual, cmp, outlet) {
    if (outlet === void 0) { outlet = shared_1.PRIMARY_OUTLET; }
    if (actual === null) {
        expect(actual).toBeDefined();
    }
    else {
        expect(actual.component).toBe(cmp);
        expect(actual.outlet).toEqual(outlet);
    }
}
function tree(url) {
    return new url_serializer_1.DefaultUrlSerializer().parse(url);
}
var RootComponent = (function () {
    function RootComponent() {
    }
    return RootComponent;
})();
var ComponentA = (function () {
    function ComponentA() {
    }
    return ComponentA;
})();
var ComponentB = (function () {
    function ComponentB() {
    }
    return ComponentB;
})();
var ComponentC = (function () {
    function ComponentC() {
    }
    return ComponentC;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlX3JvdXRlcl9zdGF0ZS5zcGVjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdGVzdC9jcmVhdGVfcm91dGVyX3N0YXRlLnNwZWMudHMiXSwibmFtZXMiOlsiYWR2YW5jZVN0YXRlIiwiYWR2YW5jZU5vZGUiLCJjcmVhdGVTdGF0ZSIsImNoZWNrQWN0aXZhdGVkUm91dGUiLCJ0cmVlIiwiUm9vdENvbXBvbmVudCIsIlJvb3RDb21wb25lbnQuY29uc3RydWN0b3IiLCJDb21wb25lbnRBIiwiQ29tcG9uZW50QS5jb25zdHJ1Y3RvciIsIkNvbXBvbmVudEIiLCJDb21wb25lbnRCLmNvbnN0cnVjdG9yIiwiQ29tcG9uZW50QyIsIkNvbXBvbmVudEMuY29uc3RydWN0b3IiXSwibWFwcGluZ3MiOiJBQUFBLCtCQUFtQyx1QkFBdUIsQ0FBQyxDQUFBO0FBQzNELHlCQUFrQyxpQkFBaUIsQ0FBQyxDQUFBO0FBRXBELHVCQUFxQyxlQUFlLENBQUMsQ0FBQTtBQUNyRCw2QkFBd0cscUJBQXFCLENBQUMsQ0FBQTtBQUM5SCxvQ0FBZ0MsNEJBQTRCLENBQUMsQ0FBQTtBQUM3RCwwQkFBd0Isa0JBQWtCLENBQUMsQ0FBQTtBQUczQyxRQUFRLENBQUMscUJBQXFCLEVBQUU7SUFDOUIsSUFBTSxVQUFVLEdBQUcsY0FBTSxPQUFBLCtCQUFnQixDQUFDLElBQUksa0JBQU8sQ0FBQyxJQUFJLHFCQUFVLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxhQUFhLENBQUMsRUFBOUUsQ0FBOEUsQ0FBQztJQUV4RyxFQUFFLENBQUMsOEJBQThCLEVBQUU7UUFDakMsSUFBTSxLQUFLLEdBQUcsdUNBQWlCLENBQUMsV0FBVyxDQUFDO1lBQzFDLEVBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFDO1lBQ2xDLEVBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFF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QUFEQSxDQUFDQSxBQUFuQixJQUFtQjtBQUNuQjtJQUFBRTtJQUFrQkMsQ0FBQ0E7SUFBREQsaUJBQUNBO0FBQURBLENBQUNBLEFBQW5CLElBQW1CO0FBQ25CO0lBQUFFO0lBQWtCQyxDQUFDQTtJQUFERCxpQkFBQ0E7QUFBREEsQ0FBQ0EsQUFBbkIsSUFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0RlZmF1bHRVcmxTZXJpYWxpemVyfSBmcm9tICcuLi9zcmMvdXJsX3NlcmlhbGl6ZXInO1xyXG5pbXBvcnQge1VybFRyZWUsIFVybFNlZ21lbnR9IGZyb20gJy4uL3NyYy91cmxfdHJlZSc7XHJcbmltcG9ydCB7VHJlZU5vZGV9IGZyb20gJy4uL3NyYy91dGlscy90cmVlJztcclxuaW1wb3J0IHtQYXJhbXMsIFBSSU1BUllfT1VUTEVUfSBmcm9tICcuLi9zcmMvc2hhcmVkJztcclxuaW1wb3J0IHtBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyU3RhdGUsIFJvdXRlclN0YXRlU25hcHNob3QsIGNyZWF0ZUVtcHR5U3RhdGUsIGFkdmFuY2VBY3RpdmF0ZWRSb3V0ZX0gZnJvbSAnLi4vc3JjL3JvdXRlcl9zdGF0ZSc7XHJcbmltcG9ydCB7Y3JlYXRlUm91dGVyU3RhdGV9IGZyb20gJy4uL3NyYy9jcmVhdGVfcm91dGVyX3N0YXRlJztcclxuaW1wb3J0IHtyZWNvZ25pemV9IGZyb20gJy4uL3NyYy9yZWNvZ25pemUnO1xyXG5pbXBvcnQge1JvdXRlckNvbmZpZ30gZnJvbSAnLi4vc3JjL2NvbmZpZyc7XHJcblxyXG5kZXNjcmliZSgnY3JlYXRlIHJvdXRlciBzdGF0ZScsICgpID0+IHtcclxuICBjb25zdCBlbXB0eVN0YXRlID0gKCkgPT4gY3JlYXRlRW1wdHlTdGF0ZShuZXcgVXJsVHJlZShuZXcgVXJsU2VnbWVudChbXSwge30pLCB7fSwgbnVsbCksIFJvb3RDb21wb25lbnQpO1xyXG5cclxuICBpdCgnc2hvdWxkIHdvcmsgY3JlYXRlIG5ldyBzdGF0ZScsICgpID0+IHtcclxuICAgIGNvbnN0IHN0YXRlID0gY3JlYXRlUm91dGVyU3RhdGUoY3JlYXRlU3RhdGUoW1xyXG4gICAgICB7cGF0aDogJ2EnLCBjb21wb25lbnQ6IENvbXBvbmVudEF9LFxyXG4gICAgICB7cGF0aDogJ2InLCBjb21wb25lbnQ6IENvbXBvbmVudEIsIG91dGxldDogJ2xlZnQnfSxcclxuICAgICAge3BhdGg6ICdjJywgY29tcG9uZW50OiBDb21wb25lbnRDLCBvdXRsZXQ6ICdyaWdodCd9XHJcbiAgICBdLCBcImEobGVmdDpiLy9yaWdodDpjKVwiKSwgZW1wdHlTdGF0ZSgpKTtcclxuXHJcbiAgICBjaGVja0FjdGl2YXRlZFJvdXRlKHN0YXRlLnJvb3QsIFJvb3RDb21wb25lbnQpO1xyXG5cclxuICAgIGNvbnN0IGMgPSBzdGF0ZS5jaGlsZHJlbihzdGF0ZS5yb290KTtcclxuICAgIGNoZWNrQWN0aXZhdGVkUm91dGUoY1swXSwgQ29tcG9uZW50QSk7XHJcbiAgICBjaGVja0FjdGl2YXRlZFJvdXRlKGNbMV0sIENvbXBvbmVudEIsICdsZWZ0Jyk7XHJcbiAgICBjaGVja0FjdGl2YXRlZFJvdXRlKGNbMl0sIENvbXBvbmVudEMsICdyaWdodCcpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIHJldXNlIGV4aXN0aW5nIG5vZGVzIHdoZW4gaXQgY2FuJywgKCkgPT4ge1xyXG4gICAgY29uc3QgY29uZmlnID0gW1xyXG4gICAgICB7cGF0aDogJ2EnLCBjb21wb25lbnQ6IENvbXBvbmVudEF9LFxyXG4gICAgICB7cGF0aDogJ2InLCBjb21wb25lbnQ6IENvbXBvbmVudEIsIG91dGxldDogJ2xlZnQnfSxcclxuICAgICAge3BhdGg6ICdjJywgY29tcG9uZW50OiBDb21wb25lbnRDLCBvdXRsZXQ6ICdsZWZ0J31cclxuICAgIF07XHJcblxyXG4gICAgY29uc3QgcHJldlN0YXRlID0gY3JlYXRlUm91dGVyU3RhdGUoY3JlYXRlU3RhdGUoY29uZmlnLCBcImEobGVmdDpiKVwiKSwgZW1wdHlTdGF0ZSgpKTtcclxuICAgIGFkdmFuY2VTdGF0ZShwcmV2U3RhdGUpO1xyXG4gICAgY29uc3Qgc3RhdGUgPSBjcmVhdGVSb3V0ZXJTdGF0ZShjcmVhdGVTdGF0ZShjb25maWcsIFwiYShsZWZ0OmMpXCIpLCBwcmV2U3RhdGUpO1xyXG5cclxuICAgIGV4cGVjdChwcmV2U3RhdGUucm9vdCkudG9CZShzdGF0ZS5yb290KTtcclxuICAgIGNvbnN0IHByZXZDID0gcHJldlN0YXRlLmNoaWxkcmVuKHByZXZTdGF0ZS5yb290KTtcclxuICAgIGNvbnN0IGN1cnJDID0gc3RhdGUuY2hpbGRyZW4oc3RhdGUucm9vdCk7XHJcblxyXG4gICAgZXhwZWN0KHByZXZDWzBdKS50b0JlKGN1cnJDWzBdKTtcclxuICAgIGV4cGVjdChwcmV2Q1sxXSkubm90LnRvQmUoY3VyckNbMV0pO1xyXG4gICAgY2hlY2tBY3RpdmF0ZWRSb3V0ZShjdXJyQ1sxXSwgQ29tcG9uZW50QywgJ2xlZnQnKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcG9uZW50bGVzcyByb3V0ZXMnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBjb25maWcgPSBbXHJcbiAgICAgIHsgcGF0aDogJ2EvOmlkJywgY2hpbGRyZW46IFtcclxuICAgICAgICB7IHBhdGg6ICdiJywgY29tcG9uZW50OiBDb21wb25lbnRBIH0sXHJcbiAgICAgICAgeyBwYXRoOiAnYycsIGNvbXBvbmVudDogQ29tcG9uZW50Qiwgb3V0bGV0OiAncmlnaHQnIH1cclxuICAgICAgXSB9XHJcbiAgICBdO1xyXG5cclxuXHJcbiAgICBjb25zdCBwcmV2U3RhdGUgPSBjcmVhdGVSb3V0ZXJTdGF0ZShjcmVhdGVTdGF0ZShjb25maWcsIFwiYS8xO3A9MTEvKGIvL3JpZ2h0OmMpXCIpLCBlbXB0eVN0YXRlKCkpO1xyXG4gICAgYWR2YW5jZVN0YXRlKHByZXZTdGF0ZSk7XHJcbiAgICBjb25zdCBzdGF0ZSA9IGNyZWF0ZVJvdXRlclN0YXRlKGNyZWF0ZVN0YXRlKGNvbmZpZywgXCJhLzI7cD0yMi8oYi8vcmlnaHQ6YylcIiksIHByZXZTdGF0ZSk7XHJcblxyXG4gICAgZXhwZWN0KHByZXZTdGF0ZS5yb290KS50b0JlKHN0YXRlLnJvb3QpO1xyXG4gICAgY29uc3QgcHJldlAgPSBwcmV2U3RhdGUuZmlyc3RDaGlsZChwcmV2U3RhdGUucm9vdCk7XHJcbiAgICBjb25zdCBjdXJyUCA9IHN0YXRlLmZpcnN0Q2hpbGQoc3RhdGUucm9vdCk7XHJcbiAgICBleHBlY3QocHJldlApLnRvQmUoY3VyclApO1xyXG5cclxuICAgIGNvbnN0IHByZXZDID0gcHJldlN0YXRlLmNoaWxkcmVuKHByZXZQKTtcclxuICAgIGNvbnN0IGN1cnJDID0gc3RhdGUuY2hpbGRyZW4oY3VyclApO1xyXG5cclxuICAgIGV4cGVjdChjdXJyUC5fZnV0dXJlU25hcHNob3QucGFyYW1zKS50b0VxdWFsKHtpZDogJzInLCBwOiAnMjInfSk7XHJcbiAgICBjaGVja0FjdGl2YXRlZFJvdXRlKGN1cnJDWzBdLCBDb21wb25lbnRBKTtcclxuICAgIGNoZWNrQWN0aXZhdGVkUm91dGUoY3VyckNbMV0sIENvbXBvbmVudEIsICdyaWdodCcpO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGFkdmFuY2VTdGF0ZShzdGF0ZTogUm91dGVyU3RhdGUpOiB2b2lkIHtcclxuICBhZHZhbmNlTm9kZShzdGF0ZS5fcm9vdCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFkdmFuY2VOb2RlKG5vZGU6IFRyZWVOb2RlPEFjdGl2YXRlZFJvdXRlPik6IHZvaWQge1xyXG4gIGFkdmFuY2VBY3RpdmF0ZWRSb3V0ZShub2RlLnZhbHVlKTtcclxuICBub2RlLmNoaWxkcmVuLmZvckVhY2goYWR2YW5jZU5vZGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVTdGF0ZShjb25maWc6IFJvdXRlckNvbmZpZywgdXJsOiBzdHJpbmcpOiBSb3V0ZXJTdGF0ZVNuYXBzaG90IHtcclxuICBsZXQgcmVzOiBSb3V0ZXJTdGF0ZVNuYXBzaG90O1xyXG4gIHJlY29nbml6ZShSb290Q29tcG9uZW50LCBjb25maWcsIHRyZWUodXJsKSwgdXJsKS5mb3JFYWNoKHMgPT4gcmVzID0gcyk7XHJcbiAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tBY3RpdmF0ZWRSb3V0ZShhY3R1YWw6IEFjdGl2YXRlZFJvdXRlLCBjbXA6IEZ1bmN0aW9uLCBvdXRsZXQ6IHN0cmluZyA9IFBSSU1BUllfT1VUTEVUKTp2b2lkIHtcclxuICBpZiAoYWN0dWFsID09PSBudWxsKSB7XHJcbiAgICBleHBlY3QoYWN0dWFsKS50b0JlRGVmaW5lZCgpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBleHBlY3QoYWN0dWFsLmNvbXBvbmVudCkudG9CZShjbXApO1xyXG4gICAgZXhwZWN0KGFjdHVhbC5vdXRsZXQpLnRvRXF1YWwob3V0bGV0KTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRyZWUodXJsOiBzdHJpbmcpOiBVcmxUcmVlIHtcclxuICByZXR1cm4gbmV3IERlZmF1bHRVcmxTZXJpYWxpemVyKCkucGFyc2UodXJsKTtcclxufVxyXG5cclxuY2xhc3MgUm9vdENvbXBvbmVudCB7fVxyXG5jbGFzcyBDb21wb25lbnRBIHt9XHJcbmNsYXNzIENvbXBvbmVudEIge31cclxuY2xhc3MgQ29tcG9uZW50QyB7fVxyXG4iXX0=